<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Eugeni Bonet - crossreads</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/jumbotron.css" rel="stylesheet">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  
  <!-- start crossreads files -->
  <script type="text/javascript" src="data/visference-config.js"></script>
  <script type="text/javascript" src="data/data.js"></script>
  <script type='text/javascript' src='data/sim.js'></script>
  <link href="css/style.css" rel="stylesheet">
  <!-- end crossreads files -->
  
  <script>
    var LANGUAGE = "ca";
    
    function _t(myString) {
      if (LANGUAGE != "ca") {
        document.write("<script type='text/javascript' src='languages/"+LANGUAGE+".js'><//script>");
        out = LANGUAGE["myString"];
      } else {
        out = "myString";
      }
      return out;
    }
    
  </script>
</head>

<body>
  <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Project name</a>
      </div>
    </div>
  </div>

  <!-- Main jumbotron for the texts timelime/overview -->
  <div class="jumbotron">
    <div class="container">
      <h1>Hello, world!</h1>
      <p>This is a template for a simple marketing or informational website. It includes a large callout called a jumbotron and three supporting pieces of content. Use it as a starting point to create something more unique.</p>
      <p><a id="3_10" href="#" class="node btn btn-primary btn-lg" role="button">Load text 3 &raquo;</a></p>
    </div>
  </div>

  <!-- top reader container -->  
  <div id="mytopmetadata" class="container">
    <p class="translate">Estas llegint<span id="title"></span></p>
  </div>
  
  <!-- main reader container: row of three columns -->
  <div id="reader" class="container">
    <div class="row">
      <div id="myleftcolumn" class="col-md-3">
        <p>Images??</p>
      </div>

      <div id="mycentercolumn" class="col-md-6">
        <div id="toparrow" class="arrowt"></div>
        <div style="clear:both;"></div>
        <div id="text">
        </div>
      </div>

      <div id="myrightcolumn" class="col-md-3">
        <p>footnotes?</p>
      </div>
    </div>
  </div>

  <!-- bottom reader container -->
  <div id="mybottommetadata" class="container">
    <div id="bottomleft" class="mybottom col-md-4">
        <div class="arrowl">
          <img src="images/w_left_arrow.png" />
        </div>
    </div>
    
    <div id="bottomcenter" class="mybottom col-md-4">
        <div class="arrowb">
          <img src="images/w_bottom_arrow.png" />
        </div>    
    </div>
    
    <div id="bottomright" class="mybottom col-md-4">
      <div class="arrowr">
        <img src="images/w_right_arrow.png" />
      </div>
    </div>
  </div>  

  <!-- footer -->  
  <hr>
  <footer>
    <p>my foofter</p>
  </footer>

  <!-- starts core JavaScript -->
  <script src="js/jquery-1.11.0.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/underscore-min.js"></script>
  <!-- ends Bootstrap core JavaScript -->

  <!-- starts crossreads business -->
  <script>
    function loadMetadataIn(tid, mydiv)  {
      var meta = "";
      $.each( METADATA, function( key, val )  {
        if (val.tid == tid)  {
          meta += "<h2>"+val.title+"</h2>";
        }
      });
      $(mydiv).html(meta);
    }

	function loadParagraphIn(myIndex, sim) {
		if (_.has(sim, myIndex-1)) {
			leftIndex = sim[myIndex-1];
		} else {
			leftIndex = sim[sim.length-1];
		}
		if (_.has(sim, myIndex+1)) {
			rightIndex = sim[myIndex+1];
		} else {
			rightIndex = sim[0];
		}
    putParagraphIn(leftIndex, "#myleftcolumn");
    putParagraphIn(rightIndex, "#myrightcolumn");
  }

  function putParagraphIn(myIndex, mydiv)  {
    // From an index like "tid-pid" get the text tid and put the paragraph pid in div mydiv
    my = myIndex.split('_');
		tid = my[0];
		pid = my[1];
		$.getJSON( "data/texts/"+tid+".json", function( data ) {
		  var items = [];
		  $.each( data, function( key, val ) {
			items.push("<p id='p_" + val.pid + "' class='paragraph'>["+ val.pid +"/"+data.length+"]<br />" + val.p + "</p>");
		  });
  		  $(mydiv).html(items[pid]);
		});
  }

function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}

 $("a.node, a.arrow").on('click', function() {
  //alert("id: "+this.id);
  my = (this.id).split('_');
  tid = my[0];
  pid = my[1];    
  mydo(tid, pid);
 });
   
function mydo(tid, pid) {
    loadMetadataIn(tid, "#title");
    putParagraphIn(tid+"_"+pid, "#text");
    
    // top arrow checking
    var myid = tid+"_"+(pid-1);
    $("#toparrow").html('').promise().done(function(){
      if (pid-1>0)  {
        //alert("myid: "+myid);
        
        $("#toparrow").append('<a href="#" id="'+myid+'" class="arrow"><img src="images/w_top_arrow.png" /></a>');
        $("a.node, a.arrow").on('click', function() {
          //alert("id: "+this.id);
          my = (this.id).split('_');
          tid = my[0];
          pid = my[1];    
          mydo(tid, pid);
       });
      }
    });
}
//function myarrow(tid, pid)  {
   $("a.arrow").on("click", function() {
    alert("id: "+this.id);
    my = (this.id).split('_');
		tid = my[0];
    pid = my[1];
    
    loadMetadataIn(tid, "#title");
    putParagraphIn(this.id, "#text");
    
    // top arrow checking
      var myid = tid+"_"+(pid-1);
      $("#toparrow").html('').promise().done(function(){
        if (pid-1>0)  {
          alert("myid: "+myid);
          $("#toparrow").delay( 2000 ).append('<a href="#" id="'+myid+'" class="arrow"><img src="images/w_top_arrow.png" /></a>');
        }
        
      });
  });

//}


  $("\.translate").click(function() {
    
  });
  
  </script>
  <!-- ends crossreads business -->

</body>
</html>
