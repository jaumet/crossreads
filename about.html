<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Eugeni Bonet - crossreads</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/jumbotron.css" rel="stylesheet">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="css/jquery.fancybox.css" type="text/css" media="screen" />
  
  <!-- start crossreads files -->
  <script type="text/javascript" src="data/data.js"></script>
  <script type='text/javascript' src='data/sim.js'></script>
  <link href="css/style.css" rel="stylesheet">
  <!-- end crossreads files -->
  
  <script>
	var IMG_PATH = "data/images/";
    var LANGUAGE = "ca";
    
    function _t(myString) {
      if (LANGUAGE != "ca") {
        document.write("<script type='text/javascript' src='languages/"+LANGUAGE+".js'><//script>");
        out = LANGUAGE["myString"];
      } else {
        out = "myString";
      }
      return out;
    }
    
    if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
	  var msViewportStyle = document.createElement('style')
	  msViewportStyle.appendChild(
      document.createTextNode('@-ms-viewport{width:auto!important}')
	  )
	  document.querySelector('head').appendChild(msViewportStyle)
	}

  </script>
</head>

<body>
  <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#"><b>L'Ull escolta</b> - EUGENI BONET: PANTALLES, PROJECCIONS, ESCRITS.</a>
      </div>
    </div>
  </div>

  <!-- Main jumbotron for the texts timelime/overview -->
  <div class="jumbotron">
    <div class="container">
	  <div id="timeline1" style="width:500px;height: 200px;"></div>
	  <p>
		<a id="3_10" href="#" class="node btn btn-primary btn-xs">3</a>
		<span class="badge"><a id="3_10" href="#" class="node">3</a></span>
	  </p>
    </div>
  </div>

  <!-- top reader container -->  
  <div id="mytopmetadata" class="container">
    <p id="T_you-are-reading" class="mytag"></p>
    <p id="title"></p>
    <div id="toparrow" class="arrowt"></div>
  </div>
  
  <!-- main reader container: row of three columns -->
  <div id="reader" class="container">
    <div class="row">

      <div id="myleftcolumn" class="col-md-3">
        <p></p>
      </div>

      <div id="mycentercolumn" class="col-md-5">
        <div style="clear:both;"></div>
        <div id="text"></div>
      </div>

      <div id="myrightcolumn" class="col-md-3">
        <p></p>
      </div>

    </div>
  </div>

  <!-- bottom reader container -->
  <div id="mybottommetadata" class="container">

    <div id="bottomleft" class="mybottom col-md-4">
        <div class="arrowl"></div>
    </div>
    
    <div id="bottomcenter" class="mybottom col-md-4">
        <div class="arrowb"></div>    
    </div>
    
    <div id="bottomright" class="mybottom col-md-4">
      <div class="arrowr"></div>
    </div>

  </div>  

  <!-- footer -->
  <footer>
    <p>my foofter</p>
    <div id="mystore"></div>
    <div id="wname"></div>
    <div id='event-description'></div>
  </footer>


  <!---------------------------->
  <!-- starts core JavaScript -->
  <script src="js/jquery-1.11.0.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/underscore-min.js"></script>
  <script src="js/jquery.fancybox.pack.js"></script>
  <script src="js/raphael-min.js" type="text/javascript"></script>
  <script src="js/timeline.js" type="text/javascript"></script>
  <!-- ends Bootstrap core JavaScript -->
  <!-- starts crossreads business -->
  <script>
    // A DRaphaeljs texts explorer         
	var p1 = Raphael('timeline1', 700, 140);
	var text_list = [  // FIXME
			{name:'title 1',date:'1974-10-23',description:'mp3 player'},
			{name:'title 1',date:'1975-10-23',description:'mp3 player'},
			{name:'title 1',date:'1975-10-24',description:'mp3 player'},
			{name:'title 1',date:'1980-10-23',description:'mp3 player'},
			{name:'title 1',date:'1981-10-23',description:'mp3 player'},
			{name:'title 1',date:'1982-10-23',description:'mp3 player'},
			{name:'title 1',date:'1984-10-23',description:'mp3 player'},
			{name:'title 1',date:'1986-10-23',description:'mp3 player'},
			{name:'title 1',date:'1987-10-23',description:'mp3 player'},
			{name:'title 1',date:'1992-10-23',description:'mp3 player'},
			{name:'title 27-1', date: '1993-6-29',description:'touchscreen smartphone'},
			{name:'title 27-1', date: '1994-6-29',description:'touchscreen smartphone'},
			{name:'title 27-1', date: '1995-6-29',description:'touchscreen smartphone'},
			{name:'title 27-1', date: '1996-6-29',description:'touchscreen smartphone'},
			{name:'title 27-1', date: '1997-6-29',description:'touchscreen smartphone'},
			{name:'title 27-1', date: '1999-6-29',description:'touchscreen smartphone'},
			{name:'title 27-1', date: '2001-6-29',description:'touchscreen smartphone'},
			{name:'title 27-1', date: '2002-7-29',description:'touchscreen smartphone'},
			{name:'title 27-1', date: '2004-6-29',description:'touchscreen smartphone'},
			{name:'title 27-1', date: '2005-6-29',description:'touchscreen smartphone'},
			{name:'title 27-1', date: '2006-6-29',description:'touchscreen smartphone'},
			{name:'title 27-1', date: '2007-6-29',description:'touchscreen smartphone'},
			{name:'title 27-2', date: '2008-6-29',description:'touchscreen smartphone'},
			{name:'title 27-1', date: '2009-6-29',description:'touchscreen smartphone'},
			{name:'title 4', date:'2010-1-29', description:'touchscreen tablet'},
			{name:'title 4', date:'2010-3-29', description:'touchscreen tablet'},
			{name:'title 4', date:'2010-6-29', description:'touchscreen tablet'},
			{name:'title 4', date:'2012-6-29', description:'touchscreen tablet'},
			{name:'title 4', date:'2014-6-29', description:'touchscreen tablet'},
			{name:'title 5', date:'2014-6-30', description:'touchscreen tablet'}];
							
	p1.timeline.draw({events: text_list, color:'#FFF9D2'}, function(product) {
			console.log(product.name + ': ' + product.description);
	});
  function loadMetadataIn(tid, mydiv)  {
    var meta_title = "";
    var meta_rest = '';
    var meta_img = "";
    var meta_html = "";
    $.each( METADATA, function( key, val )  {
      if (val.tid == tid)  {
        meta_title = "<h2>"+val.title+"</h2>";
        
        // Check for images attached to tid
        if (val.images.length > 0) { // FIXME for more than one image
          meta_img = '<a class="fancybox" rel="group" href="'+IMG_PATH+val.images[0]+'"><img src="'+IMG_PATH+val.images[0]+'" /></a>';
        } else {
          meta_img = "";
        }     
        
        meta_rest = '['+val.year+'] '+val.topic+' ('+val.format+')';
        
        meta_html = '<div class="list-group">\
          <a id="'+val.tid+'_0" href="#" class="node list-group-item active">\
          <h4 class="list-group-item-heading">'+meta_title+'</h4>\
          <p id="mymeta" class="list-group-item-text"><i>'+meta_rest+'</i></p></a></div>';
          
        $("p.mytag").html("Estas llegint");
        $("#myleftcolumn").html(meta_img);
        
      }
    });
    
    $(mydiv).html(meta_html);
    // Preparing smoth animate() for #text and #title
    $("#title h2").css({ "opacity": "0" });
    $("#text p").css({ "opacity": "0" });
  }

	function loadLeftAndRightLinks(myIndex, sim) {
		console.log("loadParagraphIn(myIndex, sim) - myIndex: "+myIndex+" | sim: "+sim);
		if (_.has(sim, myIndex-1)) {
			leftIndex = sim[myIndex-1];
		} else {
			leftIndex = sim[sim.length-1];
		}
		if (_.has(sim, myIndex+1)) {
			rightIndex = sim[myIndex+1];
		} else {
			rightIndex = sim[0];
		}
		console.log("leftIndex: "+leftIndex+" | rightIndex: "+rightIndex);
		$("#bottomleft div").html('<a href="#" id="'+leftIndex+'" class="arrow"><img src="images/w_left_arrow.png" /></a>');
		$("#bottomright div").html('<a href="#" id="'+rightIndex+'" class="arrow"><img src="images/w_right_arrow.png" /></a>');
  }

  function putParagraphIn(myIndex, mydiv)  {
    // From an index like "tid_pid" get the text tid and put the paragraph pid in div mydiv
    my = myIndex.split('_');
	  tid = my[0];
	  pid = my[1];
	  $.getJSON( "data/texts/"+tid+".json", function( data ) {
	    var items = [];
      var footnote = [];
	    $.each( data, function( key, val ) {
        items.push("<p id='p_" + val.pid + "' class='paragraph'>["+ (parseInt(val.pid)+1) +"/"+data.length+"]<br />" + val.p + "</p>");
        // Check for footnotes
        if (!(_.isUndefined(val.fn))) {
          footnote.push('<p>'+val.fn+'</p>');
        }  else {
          footnote.push('');
        }
	    });
  	  $(mydiv).css({ "opacity": "0" });
      //$("#title h2").css({ "opacity": "0" });
      //sleep(500);
	    $(mydiv).html(items[pid]);
      $("#myrightcolumn").html(footnote[pid]);

	    $(mydiv).animate({ "opacity": "1" }, 1300 );
 	    $("#title h2").animate({ "opacity": "1" }, 1300 );
      $("#mystore").html(data.length);
    });
    //return $("#mystore").text();
  }

  function sleep(milliseconds) {
    var start = new Date().getTime();
    for (var i = 0; i < 1e7; i++) {
      if ((new Date().getTime() - start) > milliseconds){
        break;
      }
    }
  }

  function myTrick(myid) {
    if (myid.length>2) {
      my = (myid).split('_');
      tid1 = my[0];
      pid1 = my[1];
    } else {
      pid1 = "0";
      tid1 = myid;
    }
    console.log('==> pid1: '+pid1+' | tid1: '+tid1);
    mydo(tid1, pid1);
  }

  function mydo(tid, pid) {
	
	  window.name += " | "+tid+"_"+pid;	
	  $("#wname").append(" | "+tid+"_"+pid);
	
    loadMetadataIn(tid, "#title");
    putParagraphIn(tid+"_"+pid, "#text");

    // top arrow checking
    $("#toparrow").html('').promise().done(function(){
      if ((parseInt(pid)) == 0)  {
        mypidTop = parseInt($("#mystore").text())-1;
      } else {
        mypidTop = parseInt(pid)-1;
      }
      myidTop = tid+"_"+mypidTop;
      $("#toparrow").append('<a href="#" id="'+myidTop+'" class="arrowt"><img src="images/w_top_arrow.png" /></a>');

      $("a.node, a.arrowt").on('click', function() {
        myTrick(this.id);
      });
    });

    //bottom arrow checking
    $("div.arrowb").html('').promise().done(function(){
      console.log("pid: "+(parseInt(pid)+1));
      if ((parseInt(pid) + 1) == parseInt($("#mystore").text()))  {
        mypidBottom = "0";
      } else {
        mypidBottom = parseInt(pid) + 1;
      }
      
      var myidBottom = tid+"_"+mypidBottom;
      console.log("myidBottom: "+myidBottom);
      $("div.arrowb").append('<a href="#" id="'+myidBottom+'" class="arrowb"><img src="images/w_bottom_arrow.png" /></a>');
      $("a.arrowb").on('click', function() {
        myTrick(this.id);
      });
    });

    // left & right arrows checking
    $("div.arrow").html('').promise().done(function(){
      // Get the id of the text on the centre ;-)
      myIndex = _.indexOf(sim, tid+"_"+pid);
      loadLeftAndRightLinks(myIndex, sim);

      $("a.arrow").on('click', function() {
        myTrick(this.id);
      });
    });
  }

  $("a.node, a.arrow, circle").on('click', function() {
    $("#myrightcolumn, #mycentercolumn, #myleftcolumn").css({"display":"block"});
    myTrick(this.id);
  });
  
  $(document).ready(function() {
    $(".fancybox").fancybox();
  });

  </script>
  <!-- ends crossreads business -->

</body>
</html>
