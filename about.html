<!doctype html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Eugeni Bonet - crossreads</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/jumbotron.css" rel="stylesheet">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="css/jquery.fancybox.css" type="text/css" media="screen" />
  
  <script>
    var IMG_PATH = "data/images/";

    if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
      var msViewportStyle = document.createElement('style')
      msViewportStyle.appendChild(
        document.createTextNode('@-ms-viewport{width:auto!important}')
      )
      document.querySelector('head').appendChild(msViewportStyle)
    }
  </script>
    
  <!-- start crossreads files -->
  <link href="css/style.css" rel="stylesheet">
  <script type='text/javascript' src='data/mylang.js'></script>
  <script type="text/javascript" src="data/data.js"></script>
  <script type='text/javascript' src='data/sim.js'></script>
  <!-- end crossreads files -->
  
</head>

<body>
  <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <a class="navbar-brand" href="#"><span id="mytitle"></span><b>L'Ull escolta</b> - EUGENI BONET: PANTALLES, PROJECCIONS, ESCRITS.</a>
      </div>
    </div>
  </div>

  <!-- Main jumbotron for the texts timelime/overview -->
  <div class="jumbotron">
    <div class="container">
      <table class="mytimeline">
        <tr>
			<td>
                                <c id="3_0" class="t2">.</c>
                                <c id="3_0" class="t2">.</c>
                                <c id="3_0" class="t3">.</c>
                                <c id="3_0" class="t4">.</c>
                                <c id="3_0" class="t4">.</c>
                        </td>
			<td>
                                <c id="3_0" class="t3">.</c>
                        </td>
			<td>
                                <c id="2_0" class="t1">.</c>
                                <c id="2_0" class="t2">.</c>
                                <c id="2_0" class="t2">.</c>
                                <c id="2_0" class="t3">.</c>.</c>
                        </td>
			<td>
                                <c id="3_0" class="t1">.</c>
                                <c id="3_0" class="t4">.</c>
                                <c id="3_0" class="t4">.</c>
                        </td>
			<td>
                                <c id="3_0" class="t3">.</c>
                                <c id="3_0" class="t4">.</c>
                        </td>
			<td>
                                <c id="3_0" class="t1">.</c>
                                <c id="3_0" class="t2">.</c>
                                <c id="3_0" class="t2">.</c>
                                <c id="3_0" class="t3">.</c>
                                <c id="3_0" class="t3">.</c>
                                <c id="3_0" class="t4">.</c>
                        </td>
			<td>
                                <c id="3_0" class="t2">.</c>
                        </td>
			<td>
                                <c id="3_0" class="t1">.</c>
                                <c id="3_0" class="t1">.</c>
                                <c id="3_0" class="t1">.</c>
                                <c id="3_0" class="t1">.</c>
                                <c id="3_0" class="t1">.</c>
                        </td>
			<td>
                                <c id="3_0" class="t3">.</c>
                                <c id="3_0" class="t4">.</c>
                        </td>
			<td>
                                <c id="3_0" class="t3">.</c>
                                <c id="3_0" class="t3">.</c>
                                <c id="3_0" class="t4">.</c>
                                <c id="3_0" class="t4">.</c>
                                <c id="3_0" class="t4">.</c>
                                <c id="3_0" class="t4">.</c>
                        </td>
        </tr>
        <tr>
			<td>1988</td><td>1990</td><td>1992</td><td>1994</td><td>1996</td><td>1998</td><td>2000</td><td>2002</td><td>2004</td><td>2006</td>
        </tr>        
      </table>
      <div class="legend">
        <span><b>78 texts</b>
        <br /><span class="t1c">Catalegs</span>
        <br /><span class="t2c">Critica</span>
        <br /><span class="t3c">Opinio</span>
        <br /><span class="t4c">Altres</span>
      </span></div>      
    </div>
  </div>

  <!-- top reader container -->  
  <div id="mytopmetadata" class="container">
    <p id="my_youarereading" class="mytag"></p>
    <p id="title"></p>
    <div id="toparrow" class="arrowt"></div>
  </div>
  
  <!-- main reader container: row of three columns -->
  <div id="reader" class="container">
    <div class="row">

      <div id="myleftcolumn" class="col-md-3">
        <p></p>
      </div>

      <div id="mycentercolumn" class="col-md-5">
        <div style="clear:both;"></div>
        <div id="text"></div>
      </div>

      <div id="myrightcolumn" class="col-md-3">
        <p></p>
      </div>

    </div>
  </div>

  <!-- bottom reader container -->
  <div id="mybottommetadata" class="container">

    <div id="bottomleft" class="mybottom col-md-4">
        <div class="arrowl"></div>
    </div>
    
    <div id="bottomcenter" class="mybottom col-md-4">
        <div class="arrowb"></div>    
    </div>
    
    <div id="bottomright" class="mybottom col-md-4">
      <div class="arrowr"></div>
    </div>

  </div>  

  <!-- footer -->
  <footer>
    <div id="mystore"></div>
    <div id="wname"></div>
    <div id='event-description'></div>
  </footer>

  <!---------------------------->
  <!-- starts core JavaScript -->
  <script src="js/jquery-1.11.0.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/underscore-min.js"></script>
  <script src="js/jquery.fancybox.pack.js"></script>
  <!-- ends Bootstrap core JavaScript -->

  <!-- starts crossreads business -->
  <script>
  
  function loadMetadataIn(tid, mydiv, main)  {
    var meta_title = "";
    var meta_rest = "";
    var meta_img = "";
    var meta_html = "";
    $.each( METADATA, function( key, val )  {
      if (val.tid == tid)  {
        meta_title = "<h2>"+val.title+"</h2>";
        
        // Check for images attached to tid
        if (val.images.length > 0) { // FIXME for more than one image
          meta_img = '<a class="fancybox" rel="group" href="'+IMG_PATH+val.images[0]+'"><img src="'+IMG_PATH+val.images[0]+'" /></a>';
        } else {
          meta_img = "";
        }     
        
        meta_rest = '['+val.year+'] '+val.topic+' ('+val.format+')';
        
        // Check if this is the main title-box
        if (main == "main")  {
          meta_html = '<div class="list-group">\
            <a id="'+val.tid+'_0" href="#" class="node list-group-item active">\
            <h4 class="list-group-item-heading">'+meta_title+'</h4>\
            <p id="mymeta" class="list-group-item-text"><i>'+meta_rest+'</i></p></a></div>';
        } else {
          meta_html = '<div class="jump"><b>'+val.title+'</b><br /><span>'+meta_rest+'</span></div>';
        }
        $("#my_youarereading").css({"display":"block"});
        $("#myleftcolumn").html(meta_img);
      }
    });
    
    $(mydiv).html(meta_html);
    // Preparing smoth animate() for #text and #title
    $("#title h2").css({ "opacity": "0" });
    $("#text p").css({ "opacity": "0" });
  }

  function loadLeftAndRightLinks(myIndex, sim) {
    if (_.has(sim, myIndex-1)) {
            leftIndex = sim[myIndex-1];
    } else {
            leftIndex = sim[sim.length-1];
    }
    if (_.has(sim, myIndex+1)) {
            rightIndex = sim[myIndex+1];
    } else {
            rightIndex = sim[0];
    }
    $("#bottomleft div").html('<span></span><a href="#" id="'+leftIndex+'" class="arrow"><img src="images/w_left_arrow.png" /></a>');
    $("#bottomright div").html('<a href="#" id="'+rightIndex+'" class="arrow"><img src="images/w_right_arrow.png" /></a><span></span>');
    // Right and left title boxes
    myl = leftIndex.split('_');
    loadMetadataIn(myl[0], "#bottomleft div span", "left");
    myr = rightIndex.split('_');
    loadMetadataIn(myr[0], "#bottomright div span", "right");
  }

  function putParagraphIn(myIndex, mydiv)  {
    // From an index putParagraphInlike "tid_pid" get the text tid and put the paragraph pid in div mydiv
    my = myIndex.split('_');
	  tid = my[0];
	  pid = my[1];
	  $.getJSON( "data/texts/"+tid+".json", function( data ) {
	    var items = [];
      var footnote = [];
      $.each( data, function( key, val ) {
        items.push("<div class='xofy'>"+ (parseInt(val.pid)+1) +"/"+data.length+"</div><p id='p_" + val.pid + "' class='paragraph'>" + val.p + "</p>");
        // Check for footnotes
        if (!(_.isUndefined(val.fn))) {
          footnote.push('<p>'+val.fn+'</p>');
        }  else {
          footnote.push('');
        }
      });
      $(mydiv).css({ "opacity": "0" });
      $(mydiv).html(items[pid]);
      $("#myrightcolumn").html(footnote[pid]);
      $(mydiv).animate({ "opacity": "1" }, 1300 );
      $("#title h2").animate({ "opacity": "1" }, 1300 );
      $("#mystore").html(data.length);
    });
    return $("#mystore").html();
  }

  function sleep(milliseconds) {
    var start = new Date().getTime();
    for (var i = 0; i < 1e7; i++) {
      if ((new Date().getTime() - start) > milliseconds){
        break;
      }
    }
  }

  function myTrick(myid) {
    my = (myid).split('_');
    console.log('>>>>> my: '+my);
    tid = my[0];
    pid = my[1];
    if (_.isUndefined(pid) || pid == "NaN") {
      pid = "0";
      tid = myid;
    }
    //console.log('==> tid: '+tid+' | pid: '+pid);
	
    window.name += " | "+tid+"_"+pid;	
    $("#wname").append(" | "+tid+"_"+pid);
	
    loadMetadataIn(tid, "#title", "main");
    putParagraphIn(tid+"_"+pid, "#text");
    
    // top arrow checking
    $("#mystore").promise().done(function(){
      $("#toparrow").html('').promise().done(function(){
        if (parseInt(pid) == 0)  {
          mypidTop = METADATA[tid-1]["nump"]-1;
        } else {
          mypidTop = parseInt(pid)-1;
        }
        myidTop = tid+"_"+mypidTop;
        //console.log("myidTop: "+myidTop);
        $("#toparrow").append('<a href="#" id="'+myidTop+'" class="arrowt"><img src="images/top_arrow.png" /></a>');
        $("a.node, a.arrowt").on('click', function() {
          myTrick(this.id);
        });
        return false;
      });
    });
      
    //bottom arrow checking
    $("div.arrowb").html('').promise().done(function(){
      //console.log("pid: "+(parseInt(pid)+1));
      if ((parseInt(pid) + 1) == parseInt($("#mystore").text()))  {
        mypidBottom = "0";
      } else {
        mypidBottom = parseInt(pid) + 1;
      }
      
      var myidBottom = tid+"_"+mypidBottom;
      //console.log("myidBottom: "+myidBottom);
      $("div.arrowb").append('<a href="#" id="'+myidBottom+'" class="arrowb"><img src="images/bottom_arrow.png" /></a>');
      $("a.arrowb").on('click', function() {
        myTrick(this.id);
        return false;
      });
    });

    // left & right arrows checking
    $("div.arrow").html('').promise().done(function(){
      // Get the id of the text on the centre ;-)
      myIndex = _.indexOf(sim, tid+"_"+pid);
      loadLeftAndRightLinks(myIndex, sim);

      $("a.arrow").on('click', function() {
        myTrick(this.id);
        return false;
      });
    });
  }

  $("a.node, a.arrow, c").on('click', function() {
    $("#myrightcolumn, #mycentercolumn, #myleftcolumn").css({"display":"block"});
    myTrick(this.id);
    return false;
  });
  
  $(document).ready(function() {
    $(".fancybox").fancybox();
    return false;
  });

    //////// Languages: 
    // lang object are defined in data/mylang.js
    // each string is defined as: "element id": "text string"
    function getParameterByName(name) {
      return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
    }

    var LANGUAGE = getParameterByName("l");
    if (LANGUAGE == "ca" || LANGUAGE == undefined) { LANGUAGE = "ca";}
    if (LANGUAGE == "es" ){ LANGUAGE = "es";}
    if (LANGUAGE != "ca" && LANGUAGE != "es") { LANGUAGE = "ca";}

    function langStrings(lang)  { 
      console.log("lang: "+lang);
      $.each(lang, function(key, value){
        $("#"+key).html(value);
        console.log(key + ": " + value);
      });
    } 
    langStrings(eval("lang_"+LANGUAGE));
    $("#my_youarereading").css({"display":"none"});
  </script>
  <!-- ends crossreads business -->

</body>
</html>
