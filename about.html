<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Eugeni Bonet - crossreads</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/jumbotron.css" rel="stylesheet">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  
  <!-- start crossreads files -->
  <script type="text/javascript" src="data/visference-config.js"></script>
  <script type="text/javascript" src="data/data.js"></script>
  <script type='text/javascript' src='data/sim.js'></script>
  <link href="css/style.css" rel="stylesheet">
  <!-- end crossreads files -->
  
  <script>
    var LANGUAGE = "ca";
    
    function _t(myString) {
      if (LANGUAGE != "ca") {
        document.write("<script type='text/javascript' src='languages/"+LANGUAGE+".js'><//script>");
        out = LANGUAGE["myString"];
      } else {
        out = "myString";
      }
      return out;
    }
    
  </script>
</head>

<body>
  <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#"><b>L'ull escolta</b> - EUGENI BONET: PANTALLES, PROJECCIONS, ESCRITS.</a>
      </div>
    </div>
  </div>

  <!-- Main jumbotron for the texts timelime/overview -->
  <div class="jumbotron">
    <div class="container">
      <p>................</p>
      <p><a id="3_10" href="#" class="node btn btn-primary btn-lg" role="button">Load text 3 &raquo;</a></p>
    </div>
  </div>

  <!-- top reader container -->  
  <div id="mytopmetadata" class="container">
    <p class="translate">Estas llegint<span id="title"></span></p>
    <div id="toparrow" class="arrowt"></div>
  </div>
  
  <!-- main reader container: row of three columns -->
  <div id="reader" class="container">
    <div class="row">
      <div id="myleftcolumn" class="col-md-3">
        <p>Images??</p>
      </div>

      <div id="mycentercolumn" class="col-md-6">
        <div style="clear:both;"></div>
        <div id="text"></div>
      </div>

      <div id="myrightcolumn" class="col-md-3">
        <p>footnotes?</p>
      </div>
    </div>
  </div>

  <!-- bottom reader container -->
  <div id="mybottommetadata" class="container">
    <div id="bottomleft" class="mybottom col-md-4">
        <div class="arrowl"></div>
    </div>
    
    <div id="bottomcenter" class="mybottom col-md-4">
        <div class="arrowb"></div>    
    </div>
    
    <div id="bottomright" class="mybottom col-md-4">
      <div class="arrowr"></div>
    </div>
  </div>  

  <!-- footer -->  
  <hr>
  <footer>
    <p>my foofter</p>
    <div id="mystore"></div>
    <div id="wname"></div>
  </footer>

  <!-- starts core JavaScript -->
  <script src="js/jquery-1.11.0.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/underscore-min.js"></script>
  <!-- ends Bootstrap core JavaScript -->

  <!-- starts crossreads business -->
  <script>
    function loadMetadataIn(tid, mydiv)  {
      var meta = "";
      $.each( METADATA, function( key, val )  {
        if (val.tid == tid)  {
          meta += "<h2>"+val.title+"</h2>";
        }
      });
      $(mydiv).html(meta);
    }

	function loadParagraphIn(myIndex, sim) {
		console.log("loadParagraphIn(myIndex, sim) - myIndex: "+myIndex+" | sim: "+sim);
		if (_.has(sim, myIndex-1)) {
			leftIndex = sim[myIndex-1];
		} else {
			leftIndex = sim[sim.length-1];
		}
		if (_.has(sim, myIndex+1)) {
			rightIndex = sim[myIndex+1];
		} else {
			rightIndex = sim[0];
		}
		console.log("leftIndex: "+leftIndex+" | rightIndex: "+rightIndex);
		$("#bottomleft div").html('<a href="#" id="'+leftIndex+'" class="arrow"><img src="images/w_left_arrow.png" /></a>');
		$("#bottomright div").html('<a href="#" id="'+rightIndex+'" class="arrow"><img src="images/w_right_arrow.png" /></a>');
  }

  function putParagraphIn(myIndex, mydiv)  {
    // From an index like "tid-pid" get the text tid and put the paragraph pid in div mydiv
    my = myIndex.split('_');
		tid = my[0];
		pid = my[1];
		$.getJSON( "data/texts/"+tid+".json", function( data ) {
		  var items = [];
		  $.each( data, function( key, val ) {
			items.push("<p id='p_" + val.pid + "' class='paragraph'>["+ val.pid +"/"+data.length+"]<br />" + val.p + "</p>");
		  });
  		  $(mydiv).html(items[pid]);
		  $("#mystore").html(data.length);
		});
	return $("#mystore").text();
  }

  function sleep(milliseconds) {
    var start = new Date().getTime();
    for (var i = 0; i < 1e7; i++) {
      if ((new Date().getTime() - start) > milliseconds){
        break;
      }
    }
  }

  function mydo(tid, pid, myPath) {
	
	window.name += " | "+tid+"_"+pid;	
	$("#wname").append(" | "+tid+"_"+pid);
	
    loadMetadataIn(tid, "#title");
    var numParagraphs = putParagraphIn(tid+"_"+pid, "#text");
	//console.log(">>>>>> pid+1: "+(parseInt(pid)+1)+" | numParagraphs: "+numParagraphs);

    // top arrow checking
    var myid = tid+"_"+(pid-1);
    $("#toparrow").html('').promise().done(function(){
      if ((parseInt(pid))>0)  {
        $("#toparrow").append('<a href="#" id="'+myid+'" class="arrowt"><img src="images/w_top_arrow.png" /></a>');
        $("a.node, a.arrowt").on('click', function() {
          my = (this.id).split('_');
          tid1 = my[0];
          pid1 = my[1];    
          mydo(tid1, pid1, myPath);
       });
      }
    });
    $("div.arrowb").html('').promise().done(function(){
	  console.log("pid: "+(parseInt(pid)+1)); //+" | numParagraphs: "+numParagraphs);
	  if ((parseInt(pid)+1)> parseInt($("#mystore").text()))  {
		//var myid = tid+"_0";
	    pid = "-1";
	  }
		var myid2 = tid+"_"+(parseInt(pid)+1);
		console.log("myid2: "+myid2);
		$("div.arrowb").append('<a href="#" id="'+myid2+'" class="arrowb"><img src="images/w_bottom_arrow.png" /></a>');
		$("a.arrowb").on('click', function() {
		  my2 = (this.id).split('_');
		  tid2 = my2[0];
		  pid2 = my2[1];    
		  mydo(tid2, pid2, myPath);
	   });
    });
    
	//bottom arrow checking
    $("#arrowb").html('').promise().done(function(){
      if (parseInt(pid)+1<14)  {
        //alert("myid: "+myid);
        $("#arrowb").append('<a href="#" id="'+myid+'" class="arrow"><img src="images/w_bottom_arrow.png" /></a>');
        $("div.arrow").on('click', function() {
          //alert("id: "+this.id);
          my = (this.id).split('_');
          tid = my[0];
          pid = my[1];    
          mydo(tid, pid, myPath);
       });
      }
    });

	// left arrow checking
    $("#arrowl").html('').promise().done(function(){
		
        // Get the id of the text on the centre ;-)
		myIndex = _.indexOf(sim, tid+"_"+pid);
        loadParagraphIn(myIndex, sim);
        console.log("heyyy!");
        
        $("a.arrow").on('click', function() {
          //alert("id: "+this.id);
          my = (this.id).split('_');
          tid = my[0];
          pid = my[1];    
          mydo(tid, pid, myPath);
       });
    });
  }

  $("a.node, a.arrow").on('click', function() {
	//alert("id: "+this.id);
	my = (this.id).split('_');
	tid = my[0];
	pid = my[1];    
	mydo(tid, pid);
  });

  $("\.translate").click(function() {
    
  });
  
  </script>
  <!-- ends crossreads business -->

</body>
</html>
